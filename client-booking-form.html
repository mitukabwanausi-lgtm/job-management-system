<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book a Service - Scratch Vanish</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'system-ui', '-apple-system', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .material-icons {
            vertical-align: middle;
            font-size: 20px;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>

<body class="bg-gray-50">
    <div class="min-h-screen py-8 px-4">
        <div class="max-w-2xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <img src="https://scratchvanish.com.au/wp-content/uploads/2021/11/logo.png" alt="Scratch Vanish" class="h-16 mx-auto mb-4">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Book Your Service</h1>
                <p class="text-gray-600">Fill in the details below and we'll get back to you within 24 hours</p>
            </div>

            <!-- Success Message (Hidden by default) -->
            <div id="successMessage" class="hidden bg-green-50 border border-green-200 rounded-lg p-6 mb-6">
                <div class="flex items-center gap-3 mb-2">
                    <span class="material-icons text-green-600">check_circle</span>
                    <h2 class="text-xl font-bold text-green-900">Booking Request Received!</h2>
                </div>
                <p class="text-green-800">Thank you! Your booking request has been received. We'll contact you within 24 hours to confirm details and pricing.</p>
                <button onclick="resetForm()" class="mt-4 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium">
                    Submit Another Booking
                </button>
            </div>

            <!-- Booking Form -->
            <div id="bookingFormContainer" class="bg-white rounded-lg shadow-lg p-6">
                <form id="bookingForm" onsubmit="handleSubmit(event)" class="space-y-6">
                    
                    <!-- Personal Details Section -->
                    <div class="border-b pb-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-4">Your Details</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                                <input type="text" id="clientName" required 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="John Smith">
                            </div>

                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number *</label>
                                    <input type="tel" id="clientPhone" required 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="0412 345 678">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email Address *</label>
                                    <input type="email" id="clientEmail" required 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="john@example.com">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Location Section -->
                    <div class="border-b pb-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-4">Service Location</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Street Address *</label>
                                <input type="text" id="address" required 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="123 Main Street, Sydney">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Suburb *</label>
                                <input type="text" id="suburb" required 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Sydney">
                            </div>
                        </div>
                    </div>

                    <!-- Vehicle Details Section -->
                    <div class="border-b pb-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-4">Vehicle Details</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Car Make</label>
                                <input type="text" id="carMake" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="e.g., Toyota, BMW, Honda">
                            </div>

                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Model & Year</label>
                                    <input type="text" id="carModel" 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="e.g., Corolla 2020">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Colour</label>
                                    <input type="text" id="carColour" 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="e.g., White, Black">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Service Details Section -->
                    <div class="border-b pb-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-4">Service Details</h2>
                        
                        <div class="space-y-4">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Preferred Date</label>
                                    <input type="date" id="preferredDate" 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Preferred Time</label>
                                    <input type="time" id="preferredTime" 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Brief Job Description *</label>
                                <textarea id="jobDescription" required rows="4"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Please describe the work you need done (e.g., scratch on front bumper, dent on driver's door, paint correction needed)"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="pt-2">
                        <button type="submit" id="submitButton"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors flex items-center justify-center gap-2">
                            <span class="material-icons">send</span>
                            Submit Booking Request
                        </button>
                        <p class="text-sm text-gray-500 mt-3 text-center">* Required fields</p>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="text-center mt-8 text-gray-600 text-sm">
                <p>Questions? Call us at <a href="tel:1300123456" class="text-blue-600 hover:underline">1300 123 456</a></p>
                <p class="mt-2">or email <a href="mailto:info@scratchvanish.com.au" class="text-blue-600 hover:underline">info@scratchvanish.com.au</a></p>
            </div>
        </div>
    </div>

    <script>
        // ==================== CONFIGURATION ====================
        const SUPABASE_URL = 'https://ssxcjsdoxtgddnkugntl.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzeGNqc2RveHRnZGRua3VnbnRsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3NDEwODgsImV4cCI6MjA3NzMxNzA4OH0.C-lkPRJtFYa7YAgPavXRIGvV1LPkCXOJQYoVrZ4nCMw';
        
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Set minimum date to today
        document.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.getElementById('preferredDate');
            if (dateInput) {
                const today = new Date().toISOString().split('T')[0];
                dateInput.min = today;
            }
        });

        async function handleSubmit(event) {
            event.preventDefault();

            const submitButton = document.getElementById('submitButton');
            const originalButtonText = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.innerHTML = '<span class="material-icons spin">refresh</span> Submitting...';

            try {
                // Get form values
                const clientName = document.getElementById('clientName').value.trim();
                const clientPhone = document.getElementById('clientPhone').value.trim();
                const clientEmail = document.getElementById('clientEmail').value.trim();
                const address = document.getElementById('address').value.trim();
                const suburb = document.getElementById('suburb').value.trim();
                const carMake = document.getElementById('carMake').value.trim() || null;
                const carModel = document.getElementById('carModel').value.trim() || null;
                const carColour = document.getElementById('carColour').value.trim() || null;
                const preferredDate = document.getElementById('preferredDate').value || null;
                const preferredTime = document.getElementById('preferredTime').value || null;
                const jobDescription = document.getElementById('jobDescription').value.trim();

                // Validate required fields
                if (!clientName || !clientPhone || !clientEmail || !address || !suburb || !jobDescription) {
                    alert('Please fill in all required fields');
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                    return;
                }

                // Prepare job data
                const jobData = {
                    client_name: clientName,
                    client_phone: clientPhone,
                    client_email: clientEmail,
                    address: address,
                    suburb: suburb,
                    car_make: carMake,
                    car_model: carModel,
                    car_colour: carColour,
                    date: preferredDate,
                    start_time: preferredTime ? preferredTime + ':00' : null,
                    end_time: preferredTime ? calculateEndTime(preferredTime) : null,
                    job_description: jobDescription,
                    status: 'Pending Review',
                    price: 0,
                    price_includes_gst: false,
                    priority: 'Normal',
                    contact_method: 'Client Form',
                    assigned_to: null,
                    created_at: new Date().toISOString()
                };

                // Insert into database
                const { data, error } = await supabaseClient
                    .from('jobs')
                    .insert([jobData])
                    .select();

                if (error) throw error;

                // Show success message
                document.getElementById('bookingFormContainer').classList.add('hidden');
                document.getElementById('successMessage').classList.remove('hidden');
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });

            } catch (error) {
                console.error('Error submitting booking:', error);
                alert('Sorry, there was an error submitting your booking. Please try again or call us directly.');
                submitButton.disabled = false;
                submitButton.innerHTML = originalButtonText;
            }
        }

        function calculateEndTime(startTime) {
            // Default to 1 hour after start time
            const [hours, minutes] = startTime.split(':');
            let endHour = parseInt(hours) + 1;
            if (endHour >= 24) endHour = 23;
            return `${String(endHour).padStart(2, '0')}:${minutes}:00`;
        }

        function resetForm() {
            document.getElementById('bookingForm').reset();
            document.getElementById('bookingFormContainer').classList.remove('hidden');
            document.getElementById('successMessage').classList.add('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>

</html>
